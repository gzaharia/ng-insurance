<div class="container">
  <div class="m-3 align-self-center">

    <nav>
      <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <a
          (click)="activeTab='calculator'"
          [ngClass]="{'active':activeTab==='calculator'}"
          aria-controls="nav-calculator"
          aria-selected="true"
          class="nav-item nav-link"
          data-toggle="tab"
          href="#nav-calculator"
          id="nav-calculator-tab"
          role="tab"
        >
          Calculator
        </a>
        <a
          *ngIf="calculated"
          [ngClass]="{'active':activeTab==='order'}"
          aria-controls="nav-order"
          aria-selected="false"
          class="nav-item nav-link"
          data-toggle="tab"
          href="#nav-order"
          id="nav-order-tab"
          role="tab"
        >
          Finalizarea
        </a>
      </div>
    </nav>

    <!-- Tab content -->
    <div class="tab-content" id="nav-tabContent">
      <div [ngClass]="{'show active':activeTab==='calculator'}" aria-labelledby="nav-calculator-tab" class="tab-pane fade"
           id="nav-calculator" role="tabpanel">
        <form (ngSubmit)="getPrice()">
          <div *ngFor="let category of displayedCategories; index as i" class="card-footer mt-3 form-group">
            <div *ngIf="showFlag">
              <div class="row">{{category.title}}
              </div>
              <div *ngIf="category.inputType === 'RADIO'" class="btn-group-toggle row" data-toggle="buttons"
                   role="group">
                <label (click)="nextElement(i, pId)" *ngFor="let property of category.properties; index as pId"
                       class="btn btn-secondary">
                  <input name="{{property.id}}" type="radio">{{property.title}}
                </label>
              </div>
              <div *ngIf="category.inputType === 'DROPDOWN'" class="btn-group-toggle row">
                <label>
                  <select #selectComponent class="selectpicker" (change)="nextElement(i, selectComponent.selectedIndex - 1)" data-live-search="true">
                    <option selected hidden>Alegeți o opțiune</option>
                    <option *ngFor="let property of category.properties; index as pId" value="{{pId}}">
                        {{property.title}}
                      </option>
                    </select>
                </label>
              </div>
              <div  *ngIf="category.inputType === 'RANGE'" class="btn-group-toggle row" role="group">
                <ng5-slider #sliderComponent (userChangeEnd)="nextElement(i, getLegendFromSliderOption(sliderComponent.value, i))" [(value)]="sliderValue[i]" [options]="sliderOptions[i]"></ng5-slider>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <button
                (click)="calculated = true"
                *ngIf="visible"
                class="btn btn-secondary row mb-3"
                data-target="#priceModal"
                data-toggle="modal"
                type="submit"
              >
                Calculează
              </button>
            </div>
          </div>
        </form>
      </div>

      <div
        [ngClass]="{'show active':activeTab==='order'}"
        aria-labelledby="nav-order-tab"
        class="tab-pane fade"
        id="nav-order"
        role="tabpanel"
      >
        <form
          #orderForm="ngForm"
          (ngSubmit)="orderForm.form.valid && postOrder()"
          class="mt-3"
          name="orderForm"
          novalidate
        >
          <div class="row">
            <div class="col">
              <label for="firstNameInput">Nume</label>
              <input
                #firstName="ngModel"
                [(ngModel)]="order.firstName"
                [ngClass]="{ 'is-invalid': orderForm.submitted && firstName.invalid }"
                class="form-control"
                id="firstNameInput"
                maxlength="25"
                minlength="2"
                name="firstNameInput"
                pattern="([a-zA-Z]{2,25})"
                placeholder="Nume"
                required
                type="text"
              >
              <div
                *ngIf="orderForm.submitted && firstName.invalid"
                class="invalid-feedback"
              >
                <div *ngIf="firstName.errors.required">
                  Numele este necesar!
                </div>

                <div *ngIf="firstName.errors.minlength">
                  Numele trebuie să conțină cel puțin 2 caractere!
                </div>

                <div *ngIf="firstName.errors.maxlength">
                  Numele trebuie să conțină cel mult 25 de caractere!
                </div>

                <div *ngIf="firstName.errors.pattern">
                  Nume incorect!
                </div>
              </div>
            </div>

            <div class="col">
              <label for="lastNameInput">Prenume</label>
              <input
                #lastName="ngModel"
                [(ngModel)]="order.lastName"
                [ngClass]="{ 'is-invalid': orderForm.submitted && firstName.invalid }"
                class="form-control"
                id="lastNameInput"
                maxlength="25"
                minlength="2"
                name="lastNameInput"
                pattern="([a-zA-Z]{2,25})"
                placeholder="Prenume"
                required
                type="text"
              />
              <div
                *ngIf="orderForm.submitted && lastName.invalid"
                class="invalid-feedback"
              >
                <div *ngIf="lastName.errors.required">
                  Prenumele este necesar!
                </div>

                <div *ngIf="lastName.errors.minlength">
                  Prenumele trebuie să conțină cel puțin 2 caractere!
                </div>

                <div *ngIf="lastName.errors.maxlength">
                  Prenumele trebuie să conțină cel mult 25 de caractere!
                </div>

                <div *ngIf="lastName.errors.pattern">
                  Prenume incorect!
                </div>
              </div>
            </div>
          </div>

          <div class="row mt-3">
            <div class="col">
              <label for="idnpInput">IDNP</label>
              <input
                #idnp="ngModel"
                [(ngModel)]="order.idnp"
                [ngClass]="{ 'is-invalid': orderForm.submitted && idnp.invalid }"
                class="form-control"
                id="idnpInput"
                maxlength="13"
                minlength="13"
                name="idnpInput"
                pattern="([0-9]{13})"
                placeholder="IDNP"
                required
                type="text"
              >
              <div
                *ngIf="orderForm.submitted && idnp.invalid"
                class="invalid-feedback"
              >
                <div *ngIf="idnp.errors.required">
                  IDNP este necesar!
                </div>

                <div *ngIf="idnp.errors.minlength">
                  IDNP trebuie să conțină 13 cifre!
                </div>

                <div *ngIf="idnp.errors.maxlength">
                  IDNP trebuie să conțină 13 cifre!
                </div>

                <div *ngIf="idnp.errors.pattern">
                  IDNP incorect!
                </div>
              </div>
            </div>

            <div class="col">
              <label for="rightOfPossesionInput">Dreptul de posesiune al autovehiculului</label>
              <select
                #rightOfPossession="ngModel"
                [(ngModel)]="order.rightOfPossesion"
                [ngClass]="{ 'is-invalid': orderForm.submitted && order.rightOfPossesion === '' }"
                class="form-control"
                id="rightOfPossesionInput"
                name="rightOfPossesionInput"
                required
              >
                <option hidden value="">Alegeți dreptul de posesiune</option>
                <option *ngFor="let right of rightOfPossesionList" [ngValue]="right">
                  {{right}}
                </option>
              </select>
              <div
                *ngIf="orderForm.submitted && order.rightOfPossesion === ''"
                class="invalid-feedback"
              >
                Dreptul de posesiune este necesar!
              </div>
            </div>
          </div>

          <div class="row mt-3">
            <div class="col">
              <label for="docNumberInput">Numărul certificatului de înmatriculare</label>
              <input #docNumber="ngModel"
                     [(ngModel)]="order.docNumber"
                     [ngClass]="{ 'is-invalid': orderForm.submitted && docNumber.invalid }"
                     class="form-control"
                     id="docNumberInput"
                     maxlength="9"
                     minlength="9"
                     name="docNumberInput"
                     pattern="([0-9]{9})"
                     placeholder="Numărul certificatului de înmatriculare"
                     required
                     type="text"
              >
              <div
                *ngIf="orderForm.submitted && docNumber.invalid"
                class="invalid-feedback"
              >
                <div *ngIf="docNumber.errors.required">
                  Numărul certificatului de înmatriculare este necesar!
                </div>

                <div *ngIf="docNumber.errors.minlength">
                  Numărul certificatului de înmatriculare trebuie să conțină 9 cifre!
                </div>

                <div *ngIf="docNumber.errors.maxlength">
                  Numărul certificatului de înmatriculare trebuie să conțină 9 cifre!
                </div>

                <div *ngIf="docNumber.errors.pattern">
                  Numărul certificatului de înmatriculare este incorect!
                </div>
              </div>
            </div>

            <div class="col">
              <label for="licencePlateNumberInput">Numărul de înmatriculare</label>
              <input
                #licencePlateNumber="ngModel"
                [(ngModel)]="order.licensePlateNumber"
                [ngClass]="{ 'is-invalid': orderForm.submitted && licencePlateNumber.invalid }"
                class="form-control text-uppercase"
                id="licencePlateNumberInput"
                maxlength="8"
                minlength="3"
                name="licencePlateNumberInput"
                pattern="[a-z]{2,4} [0-9]{3,4}"
                placeholder="Numărul de înmatriculare"
                required
                type="text"
              >
              <div
                *ngIf="orderForm.submitted && licencePlateNumber.invalid"
                class="invalid-feedback"
              >
                <div *ngIf="licencePlateNumber.errors.required">
                  Numărul de înmatriculare este necesar!
                </div>

                <div *ngIf="licencePlateNumber.errors.minlength">
                  Numărul de înmatriculare trebuie să conțină cel puțin 5 caractere!
                </div>

                <div *ngIf="licencePlateNumber.errors.maxlength">
                  Numărul de înmatriculare trebuie să conțină cel mult 8 caractere!
                </div>

                <div *ngIf="licencePlateNumber.errors.pattern">
                  Numărul de înmatriculare este incorect!
                </div>
              </div>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col">
              <label for="emailInput">E-mail</label>
              <input #email="ngModel"
                     [(ngModel)]="order.email"
                     [ngClass]="{ 'is-invalid': orderForm.submitted && email.invalid }"
                     class="form-control"
                     id="emailInput"
                     name="emailInput"
                     pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                     placeholder="E-mail"
                     required
                     type="email"
              >
              <div
                *ngIf="orderForm.submitted && email.invalid"
                class="invalid-feedback"
              >
                <div *ngIf="email.errors.required">
                  E-mail este necesar!
                </div>

                <div *ngIf="email.errors.pattern">
                  E-mail este incorect!
                </div>
              </div>
            </div>

            <div class="col">
              <label for="phoneNumberInput">Numărul de telefon</label>
              <input
                #phoneNo="ngModel"
                [(ngModel)]="order.phoneNo"
                [ngClass]="{ 'is-invalid': orderForm.submitted && phoneNo.invalid }"
                class="form-control"
                id="phoneNumberInput"
                maxlength="9"
                minlength="9"
                name="phoneNumberInput"
                pattern="([0])([2-3]|[5-9])([0-9]{7})"
                placeholder="Numărul de telefon"
                required
                type="text"
              >
              <div
                *ngIf="orderForm.submitted && phoneNo.invalid"
                class="invalid-feedback"
              >
                <div *ngIf="phoneNo.errors.required">
                  Numărul de telefon este necesar!
                </div>

                <div *ngIf="phoneNo.errors.minlength">
                  Numărul de telefon trebuie să conțină 9 cifre!
                </div>

                <div *ngIf="phoneNo.errors.maxlength">
                  Numărul de telefon trebuie să conțină 9 cifre!
                </div>

                <div *ngIf="phoneNo.errors.pattern">
                  Numărul de telefon este incorect!
                </div>
              </div>
            </div>
          </div>

          <div class="row mt-3">
            <div class="col">
              <button
                [disabled]="ordered"
                class="btn btn-primary"
              >
                Confirmă
              </button>
              <div *ngIf="ordered" class="spinner-border ml-2" role="status">
                <span class="sr-only">Loading...</span>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Price Modal -->
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="priceModal" role="dialog"
     tabindex="-1">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="exampleModalLabel">Prețul total</h3>
        <button aria-label="Close" class="close" data-dismiss="modal" type="button">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div *ngIf="priceFlag"
             class="badge badge-primary text-wrap"
             style="width: 100%; font-size: 72px;"
        >
          {{price}}
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-dismiss="modal" type="button">Închide</button>
        <button (click)="activeTab = 'order'" class="btn btn-primary" data-dismiss="modal" type="button">Următorul
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div aria-hidden="true" aria-labelledby="successModalLabel" class="modal fade" data-backdrop="static" id="successModal"
     role="dialog" tabindex="-1">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="successModalLabel">Succes!</h5>
      </div>
      <div class="modal-body">
        <div class="alert-success">
          Comanda dumneavoastră a fost plasată cu succes!
        </div>
      </div>
      <div class="modal-footer">
        <button
          (click)="router.navigateByUrl('/')"
          class="btn btn-primary btn-sm"
          data-dismiss="modal"
          type="button"
        >
          Înapoi la pagina principală
        </button>
      </div>
    </div>
  </div>
</div>
